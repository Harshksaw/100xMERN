"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.apiFetch = void 0;
const models_1 = require("./models");
const handleFetchResponse = (response) => {
    if (!response.ok) {
        return new Promise((_, reject) => {
            response
                .text()
                .then((text) => {
                try {
                    reject(JSON.parse(text));
                }
                catch (err) {
                    reject(text);
                }
            })
                .catch(reject);
        });
    }
    return response.json();
};
const apiFetch = (options) => (query, variables = {}) => {
    const fetchOptions = options[1] || {};
    if (fetchOptions.method && fetchOptions.method === 'GET') {
        return fetch(`${options[0]}?query=${encodeURIComponent(query)}`, fetchOptions)
            .then(handleFetchResponse)
            .then((response) => {
            if (response.errors) {
                throw new models_1.GraphQLError(response);
            }
            return response.data;
        });
    }
    return fetch(`${options[0]}`, Object.assign({ body: JSON.stringify({ query, variables }), method: 'POST', headers: {
            'Content-Type': 'application/json',
        } }, fetchOptions))
        .then(handleFetchResponse)
        .then((response) => {
        if (response.errors) {
            throw new models_1.GraphQLError(response);
        }
        return response.data;
    });
};
exports.apiFetch = apiFetch;
//# sourceMappingURL=apiFetch.js.map